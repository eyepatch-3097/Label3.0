{% extends "base.html" %}

{% block title %}
Preview Labels – {{ template.name }}
{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-10">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <div>
        <h1 class="h4 mb-1">Preview Label</h1>
        <p class="text-muted small mb-0">
          Workspace: {{ workspace.name }} · Template: {{ template.name }} · Qty: {{ batch.quantity }}
          · EAN: {{ batch.ean_code }}
          {% if batch.gs1_code %} · GS1: {{ batch.gs1_code }}{% endif %}
        </p>
      </div>
      <div>
        <a
          href="{% url 'label_generate_start' workspace.id %}"
          class="btn btn-link btn-sm"
        >
          ← Back to Generation
        </a>
      </div>
    </div>

    <div class="card shadow-sm mb-3">
      <div class="card-body">
        <div
          class="border position-relative bg-white"
          style="width: {{ canvas_width }}px; height: {{ canvas_height }}px; overflow: hidden;"
        >
          {% for item in layout %}
          <div
            class="position-absolute small"
            style="left: {{ item.x }}px; top: {{ item.y }}px;
                   width: {{ item.width }}px; height: {{ item.height }}px;"
          >
            {% if item.field_type == 'IMAGE_URL' %}
              {% if item.value %}
                <img
                  src="{{ item.value }}"
                  alt="{{ item.name }}"
                  style="max-width: 100%; max-height: 100%; object-fit: contain;"
                />
              {% endif %}
            {% elif item.field_type == 'BARCODE' or item.field_type == 'QRCODE' %}
              {% if item.image_data_url %}
                <img
                  src="{{ item.image_data_url }}"
                  alt="{{ item.name }}"
                  style="max-width: 100%; max-height: 100%; object-fit: contain;"
                />
              {% else %}
                <span class="text-muted">{{ item.value }}</span>
              {% endif %}
            {% else %}
              <div
                class="text-uppercase"
                style="font-size: 10px; margin-bottom: 2px;"
              >
                {{ item.name }}
              </div>
              <div>{{ item.value }}</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>

        <p class="text-muted small mt-2 mb-0">
          Preview shows the first label in the batch. Batch print will generate
          {{ batch.quantity }} labels with unique QR codes if a QR field exists.
        </p>
      </div>
    </div>

    <div class="d-flex justify-content-end gap-2">
      <a
        href="{% url 'label_batch_history' workspace.id %}"
        class="btn btn-outline-secondary btn-sm"
      >
        Label History
      </a>
      <a
        href="{% url 'label_batch_print' workspace.id batch.id %}"
        class="btn btn-primary btn-sm"
      >
        Print Batch
      </a>
    </div>
  </div>
</div>
{% endblock %}
